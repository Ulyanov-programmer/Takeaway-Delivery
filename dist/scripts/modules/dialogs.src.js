import{returnScrollbarWidth as d,sleep as s}from"./general.js";export default class l{constructor(e){this.dialogActiveStateAttribute="open";this.dialogCloseButtonAttribute="[data-close-dialog-id]";this.dialogActiveSelector=`dialog[${this.dialogActiveStateAttribute}]`;this.dialogModalStateActiveClass="_dialog_modal_";var i;this.closeByClickOnBackdrop=(i=e.closeByClickOnBackdrop)!=null?i:!0,l.dialogOpeners=document.querySelectorAll("[data-open-dialog-id]");for(let t of l.dialogOpeners)t.addEventListener("click",()=>{let o=document.getElementById(t.dataset.openDialogId);o&&o.dataset.modalDialog!=null?t.dataset.closeOpenedDialogs==null?this.openDialog(o):this.openDialog(o,!0):o&&this.openWindowDialog(o)});let a=document.querySelectorAll(this.dialogCloseButtonAttribute);for(let t of a)t.addEventListener("click",()=>{let o=document.getElementById(t.dataset.closeDialogId);o==null&&t.dataset.closeDialogId==""&&(o=this.getParentDialog(t)),o&&o.dataset.modalDialog?t.dataset.closeDialogId?this.closeDialog(o):this.closeDialog(this.getParentDialog(t)):o&&this.closeWindowDialog(o)});l.dialogModalElements=document.querySelectorAll("dialog[data-modal-dialog]");for(let t of l.dialogModalElements)t.style.padding="0",t.style.border="none",t.style.margin="0",t.style.height="fit-content",t.style.width="fit-content",t.addEventListener("close",o=>{o.preventDefault(),this.closeDialog(t)});l.dialogWindowElements=document.querySelectorAll("dialog:not([data-modal-dialog])")}openDialog(e,a=!1){if(a)for(let i of l.dialogModalElements)this.closeDialog(i);this.toggleBodyScroll(!1,e),e.showModal(),e.classList.add(this.dialogModalStateActiveClass),this.closeByClickOnBackdrop&&e.addEventListener("pointerdown",this.closeByClickOnBackdropEvent.bind(this))}closeDialog(e){e==null||e.close(),e.classList.remove(this.dialogModalStateActiveClass),this.toggleBodyScroll(!0,e),this.closeByClickOnBackdrop&&(e==null||e.removeEventListener("pointerdown",this.closeByClickOnBackdropEvent.bind(this)))}openWindowDialog(e){e.show()}closeWindowDialog(e){e==null||e.close()}async toggleBodyScroll(e,a){if(e){if(document.querySelector(`.${this.dialogModalStateActiveClass}`))return;let i=parseFloat(getComputedStyle(a).transitionDuration)*1e3;await s(i),document.body.style.paddingRight="",document.body.style.overflow=""}else d()>0&&(document.body.style.paddingRight=d()+"px"),document.body.style.overflow="hidden"}getParentDialog(e){return e.closest("dialog")}closeByClickOnBackdropEvent(e){e.target==e.currentTarget&&this.closeDialog(e.target)}}
